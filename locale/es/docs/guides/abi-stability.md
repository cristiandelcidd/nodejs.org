---
title: Estabilidad ABI
layout: docs.hbs
---

# Estabilidad ABI

## Introducción
Una interfaz binaria de aplicación (ABI) es una forma en que los programas llaman a funciones y usan estructuras de datos de otros programas compilados. Es la versión compilada de una interfaz de programación de aplicaciones (API). En otras palabras, los archivos de encabezados que describen las clases, funciones, estructuras de datos, enumeraciones y constantes que permiten a una aplicación realizar una tarea deseada se corresponden, mediante la compilación, con un conjunto de direcciones y valores de parámetros esperados y tamaños de estructura de memoria y diseños con que se compiló el proveedor del ABI.

La aplicación que usa la ABI debe compilarse de manera que las direcciones disponibles, los valores de parámetros esperados y los tamaños y diseños de la estructura de la memoria coincidan con aquellos con los que se compiló el proveedor de ABI. Esto generalmente se logra compilando con los encabezados proporcionados por el proveedor ABI.

Dado que el proveedor de ABI y el usuario de ABI pueden compilarse en diferentes momentos con diferentes versiones del compilador, una parte de la responsabilidad de garantizar la compatibilidad de ABI recae en el compilador. Las diferentes versiones del compilador, quizás proporcionadas por diferentes proveedores, deben producir la misma ABI a partir de un archivo de encabezado con un determinado contenido, y deben producir código para la aplicación utilizando el ABI que accede a la API descrita en un encabezado dado de acuerdo con las convenciones. de la ABI resultante de la descripción en el encabezado. Los compiladores modernos tienen un historial bastante bueno de no romper la compatibilidad ABI de las aplicaciones que compilan.

La responsabilidad restante de garantizar la compatibilidad de ABI recae en el equipo que mantiene los archivos de encabezado que proporcionan la API que da como resultado, tras la compilación, el ABI que debe permanecer estable. Se pueden realizar cambios en los archivos de encabezado, pero la naturaleza de los cambios debe seguirse de cerca para garantizar que, tras la compilación, la ABI no cambie de manera que los usuarios existentes de la ABI sean incompatibles con la nueva versión.

## Estabilidad ABI en Node.js
Node.js proporciona archivos de encabezado mantenidos por varios equipos independientes. Por ejemplo, el equipo de Node.js mantiene archivos de encabezado como `node.h` y` node_buffer.h`. `v8.h` es mantenido por el equipo de V8, que, aunque en estrecha cooperación con el equipo de Node.js, es independiente y tiene su propio horario y prioridades. Por lo tanto, el equipo de Node.js solo tiene control parcial sobre los cambios que se introducen en los encabezados que proporciona el proyecto. Como resultado, el proyecto Node.js adoptó [versiones semánticas] (https://semver.org/). Esto asegura que las API proporcionadas por el proyecto darán como resultado una ABI estable para todas las versiones menores y de parche de Node.js lanzadas dentro de una versión principal. En la práctica, esto significa que el proyecto Node.js se ha comprometido a garantizar que un complemento nativo de Node.js compilado con una versión principal determinada de Node.js se cargue correctamente cuando lo cargue cualquier versión menor o parche de Node.js dentro de la principal. versión contra la que se compiló.

## N-API
Ha surgido la demanda de equipar Node.js con una API que dé como resultado una ABI que se mantenga estable en varias versiones principales de Node.js. La motivación para crear una API de este tipo es la siguiente:

* El lenguaje JavaScript se ha mantenido compatible consigo mismo desde sus primeros días, mientras que la ABI del motor que ejecuta el código JavaScript cambia con cada versión principal de Node.js. Esto significa que las aplicaciones que consisten en paquetes de Node.js escritos completamente en JavaScript no necesitan recompilarse, reinstalarse o implementarse nuevamente, ya que una nueva versión principal de Node.js se coloca en el entorno de producción en el que se ejecutan dichas aplicaciones. Por el contrario, si una aplicación depende de un paquete que contiene un complemento nativo, la aplicación se debe volver a compilar, reinstalar y volver a implementar cada vez que se introduce una nueva versión principal de Node.js en el entorno de producción. Esta disparidad entre los paquetes de Node.js que contienen complementos nativos y los que están escritos completamente en JavaScript se ha sumado a la carga de mantenimiento de los sistemas de producción que dependen de complementos nativos.

* Otros proyectos han comenzado a producir interfaces JavaScript que son esencialmente implementaciones alternativas de Node.js. Dado que estos proyectos generalmente se construyen en un motor de JavaScript diferente al V8, sus complementos nativos necesariamente toman una estructura diferente y usan una API diferente. Sin embargo, el uso de una única API para un complemento nativo en diferentes implementaciones de la API de JavaScript de Node.js permitiría a estos proyectos aprovechar el ecosistema de paquetes de JavaScript que se ha acumulado alrededor de Node.js.

* Node.js puede contener un motor de JavaScript diferente en el futuro. Esto significa que, externamente, todas las interfaces de Node.js permanecerían iguales, pero el archivo de encabezado V8 estaría ausente. Tal paso causaría la interrupción del ecosistema de Node.js en general, y el de los complementos nativos en particular, si una API que es independiente del motor de JavaScript no es proporcionada primero por Node.js y adoptada por complementos nativos.

Con estos fines, Node.js ha introducido N-API en la versión 8.6.0 y lo ha marcado como un componente estable del proyecto a partir de Node.js 8.12.0. La API se define en los encabezados [`node_api.h`][] y [` node_api_types.h`][], y proporciona una garantía de compatibilidad con versiones posteriores que cruza el límite de la versión principal de Node.js. La garantía puede expresarse de la siguiente manera:

**Una versión *n* dada de N-API estará disponible en la versión principal de Node.js en la que se publicó y en todas las versiones posteriores de Node.js, incluidas las versiones principales posteriores.**

El autor de un complemento nativo puede aprovechar la garantía de compatibilidad hacia adelante de N-API asegurándose de que el complemento solo utilice las API definidas en `node_api.h` y las estructuras de datos y constantes definidas en` node_api_types.h`. Al hacerlo, el autor facilita la adopción de su complemento al indicar a los usuarios de producción que la carga de mantenimiento de su aplicación no aumentará más con la adición del complemento nativo a su proyecto de lo que lo haría con la adición de un paquete escrito exclusivamente en JavaScript.

La N-API está versionada porque se agregan nuevas API de vez en cuando. A diferencia del control de versiones semántico, el control de versiones de N-API es acumulativo. Es decir, cada versión de N-API transmite el mismo significado que una versión menor en el sistema semver, lo que significa que todos los cambios realizados en N-API serán compatibles con versiones anteriores. Además, se agregan nuevas N-API bajo una bandera experimental para brindar a la comunidad la oportunidad de examinarlas en un entorno de producción. El estado experimental significa que, aunque se ha tenido cuidado para garantizar que la nueva API no tenga que ser modificada de una manera incompatible con ABI en el futuro, aún no se ha probado suficientemente en producción que sea correcta y útil tal como se diseñó y, como tal, puede sufrir cambios incompatibles con ABI antes de que finalmente se incorpore en una próxima versión de N-API. Es decir, una N-API experimental aún no está cubierta por la garantía de compatibilidad hacia adelante.
